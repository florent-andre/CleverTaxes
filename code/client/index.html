<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
    	<title>Your public money in your hand</title>
	    
	    <link rel="icon" type="image/x-icon" href="../resources/images/favicon.ico" />
	    
	    
		<link rel="stylesheet" type="text/css" media="all" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css" />
		
	    <!-- header and footer -->
		<style type="text/css" title="currentStyle">
		    @import "resources/css/demo_table.css";
			@import "resources/css/propertiesDisplay.css";
		</style>
	    
	    <style type="text/css">
			.chart div {
			  font: 10px sans-serif;
			  background-color: steelblue;
			  text-align: right;
			  padding: 3px;
			  margin: 1px;
			  color: white;
			}
			
				.chart2 div {
			  font: 10px sans-serif;
			  background-color: steelblue;
			  text-align: right;
			  padding: 3px;
			  margin: 1px;
			  color: white;
			}
					  
				.chart2 div.my {
			  background-color: green;
			}
			
			.chart2 div.state {
			  background-color: steelblue;
			}	  	  
	    </style>
	    
	    <link rel="stylesheet" type="text/css" href="resources/css/style.css" />
	    
		<!-- End styles -->
		
		<script type="text/javascript" src="http://d3js.org/d3.v3.min.js"></script>
		
	    <!-- TODO: extract commons libs from import -->
	    <script type="text/javascript" src="resources/js/libs/jquery-1.7.1.min.js"></script>
	    <script type="text/javascript" src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
	    
	    <!-- select2 dependencies -->
		<script type="text/javascript" src="resources/js/libs/select2/select2.js"></script>
		<link rel="stylesheet" href="resources/js/libs/select2/select2.css" type="text/css" media="screen" />
		
		<!-- mock datas -->
		<script type="text/javascript" src="./data/rawData.js"></script>
		<script type="text/javascript" src="./data/dataInit.js"></script>
	    
	    <script type="text/javascript">
	    	$(document).ready(function(){
	    		
	    		var taxAmount;
	    		var x;
	    		
	    		$("#valid").click(function(){
	    			taxAmount = +$("#taxamount").attr("value");
	    			
	    			var valuesdata = [];
		    		rawData.lines.forEach(function(d){
		    			valuesdata.push(d.amount);
		    		})
		    		
		    		var data = rawData.lines;
		    		
		    		var x = d3.scale.linear()
	    		    .domain([0, d3.max(data,function(d) { 
	    		    	return taxAmount*d.percentage; })]) //TODO : use accessor function
	    		    .range([0, 420]);
	    		    
	    		    
	    		    
	    		    
	    			disp();
	    			
	    		
	    		
// 	    		var margin = {top: 20, right: 20, bottom: 30, left: 40},
// 	    	    width = 960 - margin.left - margin.right,
// 	    	    height = 500 - margin.top - margin.bottom;

// 	    	var x0 = d3.scale.ordinal()
// 	    	    .rangeRoundBands([0, width], .1);

// 	    	var x1 = d3.scale.ordinal();

// 	    	var y = d3.scale.linear()
// 	    	    .range([height, 0]);

// 	    	var color = d3.scale.ordinal()
// 	    	    .range(["#98abc5", "#8a89a6", "#7b6888", "#6b486b", "#a05d56", "#d0743c", "#ff8c00"]);

// 	    	var xAxis = d3.svg.axis()
// 	    	    .scale(x0)
// 	    	    .orient("bottom");

// 	    	var yAxis = d3.svg.axis()
// 	    	    .scale(y)
// 	    	    .orient("left")
// 	    	    .tickFormat(d3.format(".2s"));

// 	    	var svg = d3.select("body").append("svg")
// 	    	    .attr("width", width + margin.left + margin.right)
// 	    	    .attr("height", height + margin.top + margin.bottom)
// 	    	  .append("g")
// 	    	    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

// 	    	d3.csv("data.txt", function(error, data) {
// 	    	  var ageNames = d3.keys(data[0]).filter(function(key) { return key !== "State"; });

// 	    	  data.forEach(function(d) {
// 	    	    d.ages = ageNames.map(function(name) { return {name: name, value: +d[name]}; });
// 	    	  });

// 	    	  x0.domain(data.map(function(d) { return d.State; }));
// 	    	  x1.domain(ageNames).rangeRoundBands([0, x0.rangeBand()]);
// 	    	  y.domain([0, d3.max(data, function(d) { return d3.max(d.ages, function(d) { return d.value; }); })]);

// 	    	  svg.append("g")
// 	    	      .attr("class", "x axis")
// 	    	      .attr("transform", "translate(0," + height + ")")
// 	    	      .call(xAxis);

// 	    	  svg.append("g")
// 	    	      .attr("class", "y axis")
// 	    	      .call(yAxis)
// 	    	    .append("text")
// 	    	      .attr("transform", "rotate(-90)")
// 	    	      .attr("y", 6)
// 	    	      .attr("dy", ".71em")
// 	    	      .style("text-anchor", "end")
// 	    	      .text("Population");

// 	    	  var state = svg.selectAll(".state")
// 	    	      .data(data)
// 	    	    .enter().append("g")
// 	    	      .attr("class", "g")
// 	    	      .attr("transform", function(d) { return "translate(" + x0(d.State) + ",0)"; });

// 	    	  state.selectAll("rect")
// 	    	      .data(function(d) { 
// 	    	    	  return d.ages; })
// 	    	    .enter().append("rect")
// 	    	      .attr("width", x1.rangeBand())
// 	    	      .attr("x", function(d) { return x1(d.name); })
// 	    	      .attr("y", function(d) { return y(d.value); })
// 	    	      .attr("height", function(d) { return height - y(d.value); })
// 	    	      .style("fill", function(d) { return color(d.name); });

// 	    	  var legend = svg.selectAll(".legend")
// 	    	      .data(ageNames.slice().reverse())
// 	    	    .enter().append("g")
// 	    	      .attr("class", "legend")
// 	    	      .attr("transform", function(d, i) { return "translate(0," + i * 20 + ")"; });

// 	    	  legend.append("rect")
// 	    	      .attr("x", width - 18)
// 	    	      .attr("width", 18)
// 	    	      .attr("height", 18)
// 	    	      .style("fill", color);

// 	    	  legend.append("text")
// 	    	      .attr("x", width - 24)
// 	    	      .attr("y", 9)
// 	    	      .attr("dy", ".35em")
// 	    	      .style("text-anchor", "end")
// 	    	      .text(function(d) { return d; });

// 	    	});
	    		
	    		

	    		
	    		//var data = [4, 8, 15, 16, 23, 42];
	    		
	    		
    		    
	    		function disp(){
	    			
	    			
	    			
		    		d3.select(".chart")
		    		  .selectAll("div")
		    		    .data(data)
		    		  .enter().append("div")
		    		    .style("width", function(d) { return x(taxAmount*d.percentage) + "px"; })
		    		    .text(function(d) { return d.label; });
		    		
					$("#hiden").show();
	    		}
	    		
	    		
	    		
	    		//part 2
	    		
	    		
	    		
	    		var dataUser = [];
	    		data.forEach(function(d,i){
	    			var duser = dataInit[i];
	    			duser.user = true;
	    			dataUser.push(d);
	    			dataUser.push(duser);
	    		});
	    		
	    		displayChart();
	    		
	    		function displayChart(){
	    			d3.select(".chart2")
		    		  .selectAll("div")
		    		    .data(dataUser)
		    		  .enter().append("div")
		    		    .style("width", function(d) { return x(taxAmount*d.percentage) + "px"; })
		    		    .text(function(d) { return d.label; })
		    			.attr("class",function(d){
		    				return d.user ? "my" :"state";
		    			})
		    			.on("click",function(d){
		    				
		    				$("#newvalue").attr("value", d.amount*d.percentage);
		    				
		    				 $( "#dialog-form" ).dialog({
		    					 autoOpen: false,
		    					 height: 300,
		    					 width: 350,
		    					 modal: true,
		    					 buttons: {
		    					 "valid": function() {
		    						 d.amount = $("#newvalue").val()*1/d.percentage;
			    					 $( this ).dialog( "close" );
			    					 displayChart();
		    					 },
		    					 Cancel: function() {
		    						 $( this ).dialog( "close" );
		    					 },
		    					 close: function() {
		    					 	allFields.val( "" ).removeClass( "ui-state-error" );
		    					 }
		    					 } 
		    				 });
		    				 
		    				 $( "#dialog-form" ).dialog( "open" );
		    				 
		    			})
		    			;
	    		}
	    		});
	    		
	    		
	    		
	    		
// 	    		var margin = {top: 20, right: 20, bottom: 30, left: 40},
// 	    		    width = 960 - margin.left - margin.right,
// 	    		    height = 500 - margin.top - margin.bottom;

// 	    		var x0 = d3.scale.ordinal()
// 	    		    .rangeRoundBands([0, width], .1);

// 	    		var x1 = d3.scale.ordinal();

// 	    		var y = d3.scale.linear()
// 	    		    .range([height, 0]);

// 	    		var color = d3.scale.ordinal()
// 	    		    .range(["#98abc5", "#8a89a6", "#7b6888", "#6b486b", "#a05d56", "#d0743c", "#ff8c00"]);

// 	    		var xAxis = d3.svg.axis()
// 	    		    .scale(x0)
// 	    		    .orient("bottom");

// 	    		var yAxis = d3.svg.axis()
// 	    		    .scale(y)
// 	    		    .orient("left")
// 	    		    .tickFormat(d3.format(".2s"));

// 	    		var svg = d3.select("body").append("svg")
// 	    		    .attr("width", width + margin.left + margin.right)
// 	    		    .attr("height", height + margin.top + margin.bottom)
// 	    		  .append("g")
// 	    		    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
	    		  
// 	    		  data = rawData.lines;
	    		  
// 	    		  var ageNames = [];
// 	    		  data.forEach(function(d){
// 	    			  ageNames.push(d);
// 	    		  })

// 	    		  x0.domain(data.map(function(d) { return d.id; }));
// 	    		  x1.domain(ageNames).rangeRoundBands([0, x0.rangeBand()]);
// 	    		  y.domain([0, d3.max(data, function(d) { return d3.max(data, function(d) { return d.amount; }); })]);

// 	    		  svg.append("g")
// 	    		      .attr("class", "x axis")
// 	    		      .attr("transform", "translate(0," + height + ")")
// 	    		      .call(xAxis);

// 	    		  svg.append("g")
// 	    		      .attr("class", "y axis")
// 	    		      .call(yAxis)
// 	    		    .append("text")
// 	    		      .attr("transform", "rotate(-90)")
// 	    		      .attr("y", 6)
// 	    		      .attr("dy", ".71em")
// 	    		      .style("text-anchor", "end")
// 	    		      .text("Population");

// 	    		  var state = svg.selectAll(".state")
// 	    		      .data(data)
// 	    		    .enter().append("g")
// 	    		      .attr("class", "g")
// 	    		      .attr("transform", function(d) { return "translate(" + x0(d.id) + ",0)"; });

// 	    		  state.selectAll("rect")
// 	    		      //.data(function(d) { return [d.amount]; })
// 	    		      .data(function(d) { 
// 	    		    	  return [d,d]; })
// 	    		    .enter().append("rect")
// 	    		      .attr("width", x1.rangeBand())
// 	    		      .attr("x", function(d) { 
// 	    		    	  return x1(d.id); })
// 	    		      .attr("y", function(d) { return y(d.amount); })
// 	    		      .attr("height", function(d) { return height - y(d.id); })
// 	    		      .style("fill", function(d) { return color(d.id); });

// 	    		  var legend = svg.selectAll(".legend")
// 	    		      .data(ageNames.slice().reverse())
// 	    		    .enter().append("g")
// 	    		      .attr("class", "legend")
// 	    		      .attr("transform", function(d, i) { return "translate(0," + i * 20 + ")"; });

// 	    		  legend.append("rect")
// 	    		      .attr("x", width - 18)
// 	    		      .attr("width", 18)
// 	    		      .attr("height", 18)
// 	    		      .style("fill", color);

// 	    		  legend.append("text")
// 	    		      .attr("x", width - 24)
// 	    		      .attr("y", 9)
// 	    		      .attr("dy", ".35em")
// 	    		      .style("text-anchor", "end")
// 	    		      .text(function(d) { return d; });
	    		
	    	});
	    </script>
  	</head>
 	<body>
 		<h1>Screen 1 : enter your annual tax amount</h1>
 		<p>your Name : <input type="text" id="name"/></p>
 		<p>your annual tax amount : <input type="number" id="taxamount"></input></p>
 		<p><input type="button" id="valid" value="GO!"> </input></p>
 		
 		<div id="hiden" style="display:none">
	 		<h1>Screen 2 : See what do politicians with</h1>
	 		<div class="chart"></div>
	 		
	 		<h1>Screen 3 : Tell politiciant what you would like they do with</h1>
	 		<div class="chart2" ></div>
	 		
	 		<h1>Screen 4 : See what others have suggest to politicians</h1>
 		</div>
	</body>
	
	<div id="dialog-form" title="Change value" style="display:none">
		<form>
			<fieldset>
			<label for="newvalue">Your value</label>
			<input type="text" name="newvalue" id="newvalue" class="text ui-widget-content ui-corner-all">
			</fieldset>
		</form>
	</div>
</html>