<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8">
 

    <title>Loading external Data with D3.js</title>
    <script src="js/d3.v3.min.js" charset="utf-8"></script>
    

</head>

<body>
	
	<script type="text/javascript">
		d3.json("js/data.json", function (data){ //callBack function
			
			var width = 500;
    		var height = 500;
    		
    		var max_val = d3.max(data, function(d) { return d.amount; })
    		
    		var v_scale = width / max_val;
    		var data_counts = data.length;
    		console.log (data_counts);
    		var bar_height = height / data_counts;
    		console.log (bar_height);
			var widthScale = d3.scale.linear()
    					.domain ([0,max_val])
    					.range ([0, width]);

    		var color = d3.scale.linear()
    				.domain([0,max_val])
    				.range(["red", "blue"]);
            
    		var axis = d3.svg.axis()
    			.scale(widthScale)
    			.ticks (5);	
    		
    		var y = d3.time.scale()
    				.range([0, height]);
    		yAxis = d3.svg.axis().scale(y).orient("left");

            var x = d3.scale.linear()
                    .domain([0, max_val])
                    .range ([0, width]);
                    
            xAxis = d3.svg.axis()
                    .scale(x)
                    .ticks(5);

           
			var canvas = d3.select("body").append("svg")//create the container
					.attr("class", "canvas")
					.attr("width", width)
  					.attr("height", height)
  					.attr("transform", "translate(10,0)")
                    .call(d3.behavior.zoom().y(y).x(x).scaleExtent([1, 8]).on("zoom", zoom))
  					
                    ;	
  			

  			canvas.selectAll ("rect")
  				.data (data)
  				.enter() //append a rect foreach data element		
					.append ("rect")
					.attr ("width", function (d){ return widthScale(d.amount);})
					.attr ("height", bar_height)
					.attr ("y", function (d, i) { return i * 40; })
					.attr ("fill", function (d) {return color(d.amount)})
					.attr("transform", "translate(10,0)")

                    ;

			canvas.selectAll ("text")
  				.data (data)
  				.enter() 	
					.append ("text")
					.attr ("fill", "black")	
					.attr ("y", function (d, i) { return i * 40 + (bar_height / 2); })
					.text (function (d){ return d.label ;})
					.attr("transform", "translate(10,0)")
					.attr ("class", "label")

			
			canvas.append("g")
				.attr("class", "xaxis")
    			.attr("transform", "translate(10,450)")
    			.call(xAxis);

    		canvas.append("g")
        		.attr("class", "yaxis")
        		.attr("transform", "translate(9,0)")
        		.call(yAxis);

    		function zoom() {
        		canvas.select(".yaxis").call(yAxis);
                canvas.select(".xaxis").call(xAxis);
        		canvas.selectAll(".canvas rect")
        			.attr("transform", "translate(10," + d3.event.translate[1] + ")scale(1, " + d3.event.scale + ")");

    			canvas.selectAll(".canvas .label")
        			.attr("transform", "translate(10," + d3.event.translate[1] + ")scale(1, " + d3.event.scale + ")");
    		}
						
		}) 
		
	</script>
</body>
<!-- https://github.com/d3/d3-plugins/tree/master/fisheye
    http://bost.ocks.org/mike/fisheye/
-->
</html>